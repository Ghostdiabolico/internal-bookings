<%- include('partials/navbar') %>

<!DOCTYPE html>
<html>
<head>
  <title>Pool Usage Calendar</title>
  <link rel="stylesheet" href="/styles/main.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    table { width: 100%; border-collapse: collapse; }
    th, td { padding: 5px; border: 1px solid #ccc; white-space: nowrap; }
    ul { padding-left: 20px; margin: 0; }
  </style>
</head>
<body>
  <div class="container mt-4">
    <h1>Pool Usage Calendar (Approved Bookings)</h1>

    <% if (bookings.length > 0) { %>
      <div class="table-responsive">
        <table class="table table-bordered table-striped align-middle">
          <thead class="table-dark">
            <tr>
              <th>Date</th>
              <th>Time</th>
              <th>Type of Use</th>
              <th>Booked by</th>
              <th>Participants</th>
              <th>Age Range</th>
              <th>Responsible Name</th>
              <th>Event Name</th>
              <th>Equipment / Setup</th>
              <th>Other Activities / Notes</th>
              <th>Approved At</th>
            </tr>
          </thead>
          <tbody>
            <% 
              function formatTime(t) {
                if (!t) return "";
                let d = new Date("1970-01-01T" + t);
                let hours = d.getHours();
                let minutes = d.getMinutes().toString().padStart(2, "0");
                let ampm = hours >= 12 ? "PM" : "AM";
                hours = hours % 12;
                hours = hours ? hours : 12;
                return `${hours}:${minutes} ${ampm}`;
              }

              function formatApprovedAt(dt) {
                if (!dt) return "";
                let d = new Date(dt);
                let day = d.getDate().toString().padStart(2,"0");
                let month = (d.getMonth()+1).toString().padStart(2,"0");
                let year = d.getFullYear();
                let hours = d.getHours();
                let minutes = d.getMinutes().toString().padStart(2,"0");
                let ampm = hours >= 12 ? "PM" : "AM";
                hours = hours % 12;
                hours = hours ? hours : 12;
                return `${day}/${month}/${year} ${hours}:${minutes} ${ampm}`;
              }
            %>

            <% bookings.forEach(b => { %>
              <tr>
                <td><%= b.date %></td>
                <td><%= formatTime(b.start_time) %> - <%= formatTime(b.finish_time) %></td>
                <td>
                  <% if (b.type_of_use === "Other" && b.type_of_use_other) { %>
                    <%= b.type_of_use_other %>
                  <% } else { %>
                    <%= b.type_of_use %>
                  <% } %>
                </td>
                <td><%= b.requester %></td>
                <td><%= b.participants || "-" %></td>
                <td><%= b.age_range || "-" %></td>
                <td><%= b.responsible_name || "-" %></td>
                <td><%= b.event_name || "-" %></td>
                <td>
                  <% if (b.equipment && b.equipment.length > 0) { %>
                    <ul class="mb-0">
                      <% b.equipment.forEach(eq => { %>
                        <li><%= eq %></li>
                      <% }) %>
                    </ul>
                  <% } else { %>
                    -
                  <% } %>
                  <% if (b.pool_config) { %> / <%= b.pool_config %><% } %>
                </td>
                <td><%= b.other_activities || "-" %> / <%= b.notes || "-" %></td>
                <td><%= formatApprovedAt(b.approved_at) %></td>
              </tr>
            <% }) %>
          </tbody>
        </table>
      </div>
    <% } else { %>
      <p>No approved bookings yet.</p>
    <% } %>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
