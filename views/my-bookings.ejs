<%- include('partials/navbar') %>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>My Bookings</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/styles/main.css">
</head>
<body>
<div class="container mt-4">
  <h1>My Pool Bookings</h1>

  <!-- Lookup form -->
  <form method="GET" action="/my-bookings" class="mb-2">
    <div class="row g-2">
      <div class="col-md-5">
        <input type="email" class="form-control" name="email" placeholder="Enter your email" value="<%= email || '' %>" required>
      </div>
      <div class="col-md-5">
        <input type="text" class="form-control" name="code" placeholder="Enter your access code" value="<%= code || '' %>" required>
      </div>
      <div class="col-md-2">
        <button type="submit" class="btn btn-primary w-100">Check Status</button>
      </div>
    </div>
  </form>

  <!-- Forgot code button -->
  <form method="GET" action="/my-bookings" class="mb-4">
    <input type="hidden" name="send_code" value="1">
    <div class="row g-2">
      <div class="col-md-10">
        <input type="email" class="form-control" name="email" placeholder="Enter your email to recover code" value="<%= email || '' %>" required>
      </div>
      <div class="col-md-2">
        <button type="submit" class="btn btn-outline-secondary w-100">Forgot Access Code?</button>
      </div>
    </div>
  </form>

  <!-- Display message from server (code sent, no booking, etc.) -->
  <% if (message) { %>
    <div class="alert alert-info"><%= message %></div>
  <% } %>

  <% if (bookings && bookings.length > 0) { %>
    <table class="table table-bordered table-striped">
      <thead>
        <tr>
          <th>Date</th>
          <th>Time</th>
          <th>Type of Use</th>
          <th>Participants</th>
          <th>Supervisors</th>
          <th>Status</th>
          <th>Feedback</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <% bookings.forEach(booking => { %>
          <tr>
            <td><%= booking.date %></td>
            <td><%= booking.start_time %> - <%= booking.finish_time %></td>
            <td><%= booking.type_of_use %></td>
            <td><%= booking.participants || '-' %></td>
            <td><%= booking.supervisors || '-' %></td>
            <td><%= booking.status %></td>
            <td><%= booking.feedback || '-' %></td>
            <td>
              <% if (booking.status === 'rejected') { %>
                <a href="/edit-booking/<%= booking.id %>" class="btn btn-sm btn-warning">Edit</a>
              <% } else { %>
                -
              <% } %>
            </td>
          </tr>
        <% }) %>
      </tbody>
    </table>
  <% } else if (email && code) { %>
    <div class="alert alert-info">No bookings found for the provided email and access code.</div>
  <% } %>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
