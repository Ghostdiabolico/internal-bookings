<%- include('partials/navbar') %>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>My Bookings</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/styles/main.css">
</head>
<body>
<div class="container mt-4">
  <h1>My Bookings</h1>

  <% if (message) { %>
    <div class="alert alert-info"><%= message %></div>
  <% } %>

  <form method="GET" action="/my-bookings" class="row g-3 mb-4">
    <div class="col-md-4">
      <input type="email" class="form-control" name="email" placeholder="Your Email" value="<%= email %>" required>
    </div>
    <div class="col-md-4">
      <input type="text" class="form-control" name="code" placeholder="Access Code" value="<%= code %>">
    </div>
    <div class="col-md-4">
      <button type="submit" class="btn btn-primary">View Bookings</button>
      <button type="submit" name="send_code" value="1" class="btn btn-secondary">Send Latest Access Code</button>
    </div>
  </form>

  <% if (bookings.length > 0) { %>
    <div class="table-responsive">
      <table class="table table-bordered table-striped">
        <thead class="table-dark">
          <tr>
            <th>Date</th>
            <th>Time</th>
            <th>Requester</th>
            <td>
  <% if (b.type_of_use === "Other" && b.type_of_use_other) { %>
    <%= b.type_of_use_other %>
  <% } else { %>
    <%= b.type_of_use %>
  <% } %>
</td>

            <th>Participants</th>
            <th>Supervisors</th>
            <th>Equipment</th>
            <th>Notes</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <% bookings.forEach(b => { %>
            <tr>
              <td><%= b.date %></td>
              <td><%= b.start_time %> - <%= b.finish_time %></td>
              <td><%= b.requester %></td>
              <td><%= b.type_of_use %></td>
              <td><%= b.participants || "-" %></td>
              <td><%= b.supervisors || "-" %></td>
              <td>
                <% if (b.equipment && b.equipment.length > 0) { %>
                  <ul class="mb-0">
                    <% b.equipment.forEach(eq => { %>
                      <li><%= eq %></li>
                    <% }) %>
                  </ul>
                <% } else { %>
                  -
                <% } %>
              </td>
              <td><%= b.notes || "-" %></td>
              <td>
                <% if (b.status === "pending") { %>
                  <span class="badge bg-warning text-dark">Pending</span>
                <% } else if (b.status === "approved") { %>
                  <span class="badge bg-success">Approved</span>
                <% } else if (b.status === "rejected") { %>
                  <span class="badge bg-danger">Rejected</span>
                <% } %>
              </td>
              <td>
                <% if (b.status === "rejected") { %>
                  <a href="/edit-booking/<%= b.id %>" class="btn btn-sm btn-outline-primary">Edit</a>
                <% } else { %>
                  -
                <% } %>
              </td>
            </tr>
          <% }) %>
        </tbody>
      </table>
    </div>
  <% } else { %>
    <p>No bookings found.</p>
  <% } %>

</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
