<%- include('partials/navbar') %>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Request Booking</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/flatpickr/dist/themes/material_blue.css" rel="stylesheet">
  <link rel="stylesheet" href="/styles/main.css">
</head>
<body>
<div class="container mt-4">
  <h1>Request Pool Booking</h1>

  <% if (submitted) { %>
    <div class="alert alert-success">
      âœ… Your booking has been submitted!<br>
      <strong>Please save your access code + your email to view or edit your booking:</strong><br>
      <span class="badge bg-primary fs-5"><%= accessCode %></span>
      <hr>
      <a href="/my-bookings?email=<%= email || '' %>&code=<%= accessCode %>" class="btn btn-outline-light btn-sm">
        ðŸ”Ž View My Bookings
      </a>
    </div>
  <% } %>

  <form method="POST" action="/form" enctype="multipart/form-data">
    <!-- Requester -->
    <div class="mb-3">
      <label for="requester" class="form-label">Requester Name:</label>
      <input type="text" class="form-control" id="requester" name="requester" required>
    </div>

    <!-- Email -->
    <div class="mb-3">
      <label for="email" class="form-label">Email:</label>
      <input type="email" class="form-control" id="email" name="email" required>
    </div>

    <!-- Responsible Name -->
    <div class="mb-3">
      <label for="responsible_name" class="form-label">Responsible Name:</label>
      <input type="text" class="form-control" id="responsible_name" name="responsible_name">
    </div>

    <!-- Type of Use -->
    <div class="mb-3">
      <label for="type_of_use" class="form-label">Type of Use:</label>
      <select class="form-select" id="type_of_use" name="type_of_use" required>
        <option value="">-- Select --</option>
        <option value="Official Swimming Carnival">Official Swimming Carnival</option>
        <option value="Diving Carnival">Diving Carnival</option>
        <option value="Not Official Swimming Carnival">Not Official Swimming Carnival</option>
        <option value="Training">Training</option>
        <option value="Event">Event</option>
        <option value="Other">Other</option>
      </select>
      <input type="text" class="form-control mt-2" id="type_of_use_other" name="type_of_use_other" placeholder="Please specify if Other">
    </div>

    <!-- Participants -->
    <div class="mb-3">
      <label for="participants" class="form-label">Participants:</label>
      <input type="number" class="form-control" id="participants" name="participants">
    </div>

    <!-- Age Range -->
    <div class="mb-3">
      <label for="age_range" class="form-label">Age Range:</label>
      <input type="text" class="form-control" id="age_range" name="age_range">
    </div>

    <!-- Supervisors -->
    <div class="mb-3">
      <label for="supervisors" class="form-label">Supervisors:</label>
      <input type="number" class="form-control" id="supervisors" name="supervisors">
    </div>

    <!-- Event Name -->
    <div class="mb-3">
      <label for="event_name" class="form-label">Event Name:</label>
      <input type="text" class="form-control" id="event_name" name="event_name">
    </div>

    <!-- Date -->
    <div class="mb-3">
      <label for="date" class="form-label">Date:</label>
      <input type="text" class="form-control" id="date" name="date" required>
    </div>

    <!-- Start Time -->
    <div class="mb-3">
      <label for="start_time" class="form-label">Start Time:</label>
      <select class="form-select" id="start_time" name="start_time" required>
        <% for(let h=0; h<24; h++) { %>
          <% for(let m=0; m<60; m+=15) { %>
            <option value="<%= `${h.toString().padStart(2,'0')}:${m.toString().padStart(2,'0')}` %>"><%= `${h.toString().padStart(2,'0')}:${m.toString().padStart(2,'0')}` %></option>
          <% } %>
        <% } %>
      </select>
    </div>

    <!-- Finish Time -->
    <div class="mb-3">
      <label for="finish_time" class="form-label">Finish Time:</label>
      <select class="form-select" id="finish_time" name="finish_time" required>
        <% for(let h=0; h<24; h++) { %>
          <% for(let m=0; m<60; m+=15) { %>
            <option value="<%= `${h.toString().padStart(2,'0')}:${m.toString().padStart(2,'0')}` %>"><%= `${h.toString().padStart(2,'0')}:${m.toString().padStart(2,'0')}` %></option>
          <% } %>
        <% } %>
      </select>
    </div>

    <!-- Equipment & Setup -->
    <div class="mb-3">
      <label class="form-label">Equipment & Setup:</label>
      <div class="row">
        <div class="col-md-4">
          <div class="form-check">
            <input class="form-check-input" type="checkbox" name="equipment[]" value="Microphone" id="eq1">
            <label class="form-check-label" for="eq1">Microphone</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" name="equipment[]" value="Touchpads and Electronic timing system" id="eq2">
            <label class="form-check-label" for="eq2">Touchpads & Timing</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" name="equipment[]" value="Meet Manager" id="eq3">
            <label class="form-check-label" for="eq3">Meet Manager</label>
          </div>
        </div>
        <div class="col-md-4">
          <div class="form-check">
            <input class="form-check-input" type="checkbox" name="equipment[]" value="Water Polo goals" id="eq4">
            <label class="form-check-label" for="eq4">Water Polo goals</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" name="equipment[]" value="Water Polo Scoreboard" id="eq5">
            <label class="form-check-label" for="eq5">Water Polo Scoreboard</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" name="equipment[]" value="Diving Boards" id="eq6">
            <label class="form-check-label" for="eq6">Diving Boards</label>
          </div>
        </div>
        <div class="col-md-4">
          <div class="form-check">
            <input class="form-check-input" type="checkbox" name="equipment[]" value="Short Course" id="eq7">
            <label class="form-check-label" for="eq7">Short Course</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" name="equipment[]" value="Long Course" id="eq8">
            <label class="form-check-label" for="eq8">Long Course</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" id="eqOtherCheck">
            <label class="form-check-label" for="eqOtherCheck">Other</label>
          </div>
          <input type="text" class="form-control mt-1" id="equipment_other" name="equipment_other" placeholder="Specify other equipment" disabled>
        </div>
      </div>
    </div>

    <script>
      const eqOtherCheck = document.getElementById("eqOtherCheck");
      const equipmentOther = document.getElementById("equipment_other");
      eqOtherCheck.addEventListener("change", () => {
        equipmentOther.disabled = !eqOtherCheck.checked;
      });
    </script>

    <!-- Other Activities -->
    <div class="mb-3">
      <label for="other_activities" class="form-label">Other activities affected by this booking:</label>
      <input type="text" class="form-control" id="other_activities" name="other_activities">
    </div>

    <!-- Notes -->
    <div class="mb-3">
      <label for="notes" class="form-label">Notes:</label>
      <textarea class="form-control" id="notes" name="notes"></textarea>
    </div>

    <!-- Risk File -->
    <div class="mb-3">
      <label for="risk_file" class="form-label">Risk File (PDF):</label>
      <input type="file" class="form-control" id="risk_file" name="risk_file" accept=".pdf,.doc,.docx">
      <div class="form-text">Max 10MB. File will be stored securely.</div>
    </div>

    <button type="submit" class="btn btn-primary">Submit Booking</button>
  </form>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

<script>
  flatpickr("#date", { dateFormat: "Y-m-d", minDate: "today" });
</script>
</body>
</html>
